$(document).ready(function () {
  $('.blog-content .faq__item .faq__item-body.jsTogglerBody').eq(0).show();
  //$('.faq-js .faq__box .faq__item-body.jsTogglerBody').eq(0).show();
  
  // a.ivanov
/*  $('#smsCode').on('input, keyup', function() {
      console.log('input');
      if($(this).val()) {
          $(this).closest('.form__item').show();
      }
  });*/
  // a.ivanov end
  
});
$(document).on('af_complete', function(event, response) {
    var form = response.form;
    if (form.attr('id') == 'modal_form') {
        if (response.success){
        		$.fancybox.close();
        		$.fancybox.open('<div class="message"><p>Thank you for your request. Our manager will contact you shortly.</p></div>');
        }
    }

    // a.ivanov
    // SIMPLIFIED LOGIC: Just enable/disable SMS field
    if (form.attr('id') == 'modal_form_discount') {
        if (response.success) {
            // SUCCESS! Set cookie and reload
            console.log('[DISCOUNT] Success! Setting cookie...');
            var expires = new Date();
            expires.setTime(expires.getTime() + (30 * 24 * 60 * 60 * 1000));
            document.cookie = 'getDiscount=Y; expires=' + expires.toUTCString() + '; path=/';
            
            $.fancybox.close();
            $.fancybox.open('<div class="message"><p>Thank you! You will receive your discount.</p></div>');
            
            setTimeout(function() {
                location.reload();
            }, 2000);
        } else {
            // FAILED - check if SMS code is required
            console.log('[DISCOUNT] Failed. Response data:', response.data);
            
            if (response.data && response.data.sms_code !== undefined) {
                console.log('[DISCOUNT] SMS code required. Enabling field...');
                // Enable SMS field
                $('#smsCode').prop('readonly', false).focus();
                $('#sms_code_field').css('opacity', '1');
            }
        }
    }

    if (form.attr('id') == 'feedback_form') {
        if (response.success){
  		      $.fancybox.open('<div class="message"><p>Thank you for your request. Our manager will contact you shortly.</p></div>');
        }
    }
});

$(document).on('mse2_load', function (e, data) {
	$('.jsTwenty').twentytwenty();
});


$(document).ready(function () {

    $(document).on('click', '.jsMorereview', function(){
      let master_id = $(this).attr('data-master');  
      let start = 3;
      let star_more = $(this).attr('data-count');  

      //console.log(master_id);

      $.ajax({
        type: 'POST',
        url: '/ajax-more.html',
        dataType: 'json',
        cache: false,
        data: ({'starmore': star_more,'master_id': master_id}),
        success: function(data) {
          $('.reviews__content').css('opacity', 1);
          //console.log(data);
          //$('.jsMorereview').remove();
          //let more_html = '<a data-count="'+start+'" data-master="" class="btn jsMorereview" href="#">View more review</a>';
          //$('#centered-box').append(more_html);
          let star_more = parseInt($('.jsMorereview').attr('data-count')); 
          let sum = star_more + 3;
          $('.jsMorereview').attr('data-count',sum);
          $('.reviews__content').append(data.service);

          if (sum > data.allcount) {
            $('.jsMorereview').remove();
          }
        },
        error: function(jqXHR, textStatus, errorThrown) {
            alert(textStatus + ' ' + errorThrown);
        },
        beforeSend : function() {
          $('.reviews__content').css('opacity', .5);
        },
      });
      return false;

    })


  $(document).on('click', '.cky-btn-accept', function () {
		$('.cky-box-bottom-left').remove();
	  $.cookie('accept', 'accept', { expires: 7 });
	    
	})
	$(document).on('click', '.cky-btn-reject', function () {
		$('.cky-box-bottom-left').remove();
	    $.cookie('accept', 'accept', { expires: 7 });

	})


  

  $('.specialist-item').each(function(){
      var max = 4; // - количество отображаемых разделов
      if ($(this).find(".specialist-item__body ul li").length > max) {
        $(this).find('.specialist-item__body ul li:gt(3)').hide();
        let url = $(this).closest('.specialist-item').attr('href');
        $(this).find('.specialist-item__body ul').append('<a href="'+url+'" class="read">see more</a>');
        /*
        $(document).on('click', '.specialist-item .read', function () {
          $(this).parent().find('li').show();
          $(this).remove();
          return false;
        })
        */
      }
  });


});



//video
$(document).on('click', '.ajaxVideoJS', function(){
    var resource_id = $(this).data('id');
    $.ajax({
    type: 'POST',
    url: '/ajax-video.html',
    dataType: 'json',
    cache: false,
    data: {
        action:'video',
        resource_id: resource_id
    },
    success: function(data) {
      if(data.text) {
        $.fancybox.open('<div class="modal style_popup_content">'+data.text+'</div>');
      }
    },
    error: function(jqXHR, textStatus, errorThrown) { 
        alert(textStatus + ' ' + errorThrown);
    },
  });
  return false;
});

$(document).on('click', '.ajaxVideoShortsJS', function(){
    var resource_id = $(this).data('id');
    $.ajax({
    type: 'POST',
    url: '/ajax-video.html',
    dataType: 'json',
    cache: false,
    data: {
        action:'videoShorts',
        resource_id: resource_id
    },
    success: function(data) {
      if(data.text) {
        $.fancybox.open('<div class="modal style_popup_content">'+data.text+'</div>');
      }
    },
    error: function(jqXHR, textStatus, errorThrown) { 
        alert(textStatus + ' ' + errorThrown);
    },
  });
  return false;
});
// Clear phone autocomplete when opening modal
$(document).on("beforeShow.fb", function() {
    setTimeout(function() {
        $("#modal_form_discount #af_phone").val("");
    }, 50);
});

// Clear phone on focus if not +1 format
$(document).on("focus", "#af_phone", function() {
    var val = $(this).val();
    if (!val || val.indexOf("+1") !== 0) {
        $(this).val("");
    }
});
